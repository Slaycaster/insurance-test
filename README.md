# Life Insurance Recommendation Engine

A full-stack web application that provides personalized life insurance recommendations based on user profile data.

## Transparency

Some of the contents here are being generated by AI. I believe that AI should be used as a tool not a programming replacement. Following content are being generated by AI:

- This README's Project Structure
- Basic Tailwind CSS Layout (`frontend/src/app/layout.tsx`, `frontend/src/app/globals.css`)
- `RecommendationService.generateRecommendation()` - for generating the mock insurance recommendation

## Features

### Frontend (Next.js)

- **Home Page**: Interactive form to collect user information (age, income, dependents, risk tolerance)
- **Recommendation Display**: Shows personalized life insurance recommendations with explanations
- **Admin Login**: Secure authentication for administrators
- **Admin Dashboard**: View all submitted recommendations in a table format with statistics

### Backend (Node.js/Express)

- **REST API**: Endpoints for recommendations and authentication
- **PostgreSQL Database**: Store user submissions and admin data
- **Rate Limiting**: Protect API endpoints from abuse
- **JWT Authentication**: Secure admin access
- **Recommendation Algorithm**: Mock algorithm based on user profile

## Project Structure

```
insurance-test/
├── package.json                    # Root monorepo configuration
├── docker-compose.yml              # PostgreSQL database setup
├── README.md                       # This file
├── backend/                        # Node.js Express backend
│   ├── package.json
│   ├── tsconfig.json
│   ├── knexfile.ts                 # Database configuration
│   ├── nodemon.json                # Development server config
│   └── src/
│       ├── index.ts                # Server entry point
│       ├── app.ts                  # Express app configuration
│       ├── database/
│       │   ├── config.ts           # Database connection
│       │   ├── migrations/         # Database migrations
│       │   └── seeds/              # Database seeds
│       ├── models/                 # Objection.js models
│       ├── services/               # Business logic
│       ├── controllers/            # Route handlers
│       ├── middleware/             # Custom middleware
│       └── routes/                 # API routes
└── frontend/                       # Next.js frontend
    ├── package.json
    ├── tsconfig.json
    ├── tailwind.config.js
    ├── next.config.js
    └── src/
        ├── app/                    # Next.js app directory
        │   ├── layout.tsx          # Root layout
        │   ├── page.tsx            # Home page
        │   ├── globals.css         # Global styles
        │   └── admin/              # Admin pages
        └── lib/                    # Utility functions
```

## Setup Instructions

### Prerequisites

- Node.js (v18 or higher)
- pnpm (package manager)
- Docker and Docker Compose

### Installation

1. **Clone the repository**

   ```bash
   git clone <repository-url>
   cd insurance-test
   ```

2. **Install dependencies**

   ```bash
   # Install all dependencies (root + workspaces)
   pnpm install -r

   # Or use the helper script
   pnpm run install:all
   ```

3. **Set up the database**

   ```bash
   # Start PostgreSQL database
   pnpm run docker:up

   # Wait for database to be ready, then run migrations and seeds
   pnpm run db:setup
   ```

4. **Set up environment variables**
   Create a `.env` file in the backend directory:

   ```bash
   # backend/.env
   PORT=3001
   NODE_ENV=development

   # Database
   DB_HOST=localhost
   DB_PORT=5432
   DB_NAME=insurance_db
   DB_USER=insurance_user
   DB_PASSWORD=insurance_pass

   # JWT
   JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
   JWT_EXPIRES_IN=24h

   # Admin credentials
   ADMIN_EMAIL=admin@insurance.com
   ADMIN_PASSWORD=admin123
   ```

5. **Start the development servers**

   ```bash
   # Start both frontend and backend
   pnpm run dev
   ```

   Or start them separately:

   ```bash
   # Backend (runs on http://localhost:3001)
   pnpm run dev:backend

   # Frontend (runs on http://localhost:3000)
   pnpm run dev:frontend
   ```

## Usage

### For Users (Public)

1. Visit `http://localhost:3000`
2. Fill out the recommendation form with your:
   - Age (18-100)
   - Annual income
   - Number of dependents
   - Risk tolerance (Low/Medium/High)
3. Submit to receive a personalized recommendation

### For Administrators

1. Visit `http://localhost:3000/admin/login`
2. Login with demo credentials:
   - Email: `admin@insurance.com`
   - Password: `admin123`
3. View all submitted recommendations in the dashboard

## API Endpoints

### Public Endpoints

- `POST /api/recommendations` - Get a life insurance recommendation
- `GET /api/health` - Health check endpoint

### Admin Endpoints

- `POST /api/auth/login` - Admin login
- `GET /api/auth/verify` - Verify JWT token
- `GET /api/recommendations` - Get all recommendations (admin only)

## Database Schema

### Users Table

- `id` - Primary key
- `email` - Admin email
- `password_hash` - Hashed password
- `role` - User role (admin)
- `created_at`, `updated_at` - Timestamps

### Recommendations Table

- `id` - Primary key
- `age` - User age
- `income` - Annual income
- `dependents` - Number of dependents
- `risk_tolerance` - Risk tolerance level
- `recommendation_type` - Type of insurance recommended
- `coverage_amount` - Recommended coverage amount
- `term_length` - Recommended term length
- `explanation` - Recommendation explanation
- `ip_address` - User IP address
- `created_at`, `updated_at` - Timestamps

## Technology Stack

### Backend

- **Node.js** with **Express.js** - Server framework
- **TypeScript** - Type safety
- **PostgreSQL** - Database
- **Knex.js** - Query builder
- **Objection.js** - ORM
- **JWT** - Authentication
- **bcryptjs** - Password hashing
- **express-rate-limit** - Rate limiting
- **helmet** - Security middleware

### Frontend

- **Next.js 14** - React framework
- **TypeScript** - Type safety
- **Tailwind CSS** - Styling
- **React Hook Form** - Form management
- **Axios** - HTTP client
- **js-cookie** - Cookie management
- **react-hot-toast** - Notifications

## Rate Limiting

The application implements rate limiting to prevent abuse on public API endpoints.

## Security Features

- JWT-based authentication
- Password hashing with bcryptjs
- Rate limiting on all endpoints
- CORS configuration
- Helmet security middleware
- Input validation with express-validator

## Development Commands

```bash
# Install all dependencies (recommended)
pnpm install -r

# Alternative installation
pnpm run install:all

# Start development servers
pnpm run dev

# Start only backend
pnpm run dev:backend

# Start only frontend
pnpm run dev:frontend

# Build for production
pnpm run build

# Start production server
pnpm run start

# Type checking
pnpm run typecheck           # Check both projects
pnpm run typecheck:backend   # Check backend only
pnpm run typecheck:frontend  # Check frontend only

# Database commands
pnpm run docker:up      # Start PostgreSQL
pnpm run docker:down    # Stop PostgreSQL
pnpm run db:setup       # Run migrations and seeds
```
